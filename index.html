<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crash Runner - Casino</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }
        #game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            width: 100%;
            max-width: 320px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            box-sizing: border-box;
        }
        #multiplier {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
        #status, #probability {
            font-size: 12px;
            margin: 5px 0;
            color: #e0e0e0;
        }
        #wallet {
            font-size: 12px;
            color: #00e676;
            margin: 5px 0;
        }
        #bet-container {
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        input[type="number"] {
            padding: 5px;
            font-size: 12px;
            width: 70px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        button {
            padding: 6px 12px;
            font-size: 12px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 15px;
            transition: transform 0.2s;
        }
        button:hover:not(:disabled) {
            transform: scale(1.05);
        }
        button#start {
            background: linear-gradient(45deg, #4caf50, #81c784);
        }
        button#cashout {
            background: linear-gradient(45deg, #ff9800, #ffb300);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #game-canvas {
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.2);
            width: 100%;
            height: 120px;
            margin: 10px 0;
        }
        #history {
            font-size: 10px;
            color: #b0bec5;
            max-height: 60px;
            overflow-y: auto;
            margin-top: 10px;
        }
        h1 {
            font-size: 18px;
            margin: 0 0 10px 0;
        }
        @media (max-width: 360px) {
            #game-container {
                padding: 10px;
            }
            #multiplier {
                font-size: 28px;
            }
            button {
                padding: 5px 10px;
                font-size: 10px;
            }
            input[type="number"] {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Crash Runner</h1>
        <div id="wallet">Portefeuille : 100.00€</div>
        <div id="multiplier">1.00x</div>
        <canvas id="game-canvas" width="280" height="120"></canvas>
        <div id="status">Placez votre mise pour commencer.</div>
        <div id="probability">Probabilité de crash : 0%</div>
        <div id="bet-container">
            <label>Mise (€) : </label>
            <input type="number" id="bet" min="1" max="100" value="10">
        </div>
        <button id="start">Démarrer</button>
        <button id="cashout" disabled>Encaisser</button>
        <div id="history"></div>
    </div>

    <script>
        let multiplier = 1.0;
        let isCrashed = false;
        let isRunning = false;
        let crashPoint = 0;
        let interval;
        let bet = 0;
        let winnings = 0;
        let wallet = 100.0;
        let horseX = 0;
        let curvePoints = [];
        let gameCount = 0;
        let earlyCashouts = 0;
        let penaltyGames = 0;
        let rocketY = -30; // Position initiale de la fusée
        let explosion = false; // État de l’explosion
        let explosionParticles = []; // Particules de l’explosion

        const canvas = document.getElementById("game-canvas");
        const ctx = canvas.getContext("2d");
        const multiplierDisplay = document.getElementById("multiplier");
        const statusDisplay = document.getElementById("status");
        const probabilityDisplay = document.getElementById("probability");
        const walletDisplay = document.getElementById("wallet");
        const betInput = document.getElementById("bet");
        const startButton = document.getElementById("start");
        const cashoutButton = document.getElementById("cashout");
        const historyDisplay = document.getElementById("history");

        // Générer un crash truqué
        function generateCrashPoint() {
            gameCount++;
            if (penaltyGames > 0) {
                penaltyGames--;
                return 1.0;
            }

            const random = Math.random();
            if (gameCount === 1) {
                return 20;
            } else if (gameCount === 2) {
                return 15;
            } else if (random < 0.01 && gameCount > 10) {
                return 100 + random * 20;
            } else if (random < 0.6) {
                return 1.1 + random * 1.9;
            } else if (random < 0.9) {
                return 3 + random * 2;
            } else {
                return 5 + random * 5;
            }
        }

        // Probabilité affichée (illusion)
        function calculateCrashProbability() {
            const maxCrash = 120;
            return Math.min(100, ((multiplier - 1) / (maxCrash - 1)) * 70);
        }

        // Générer particules d’explosion
        function createExplosion(x, y) {
            explosion = true;
            for (let i = 0; i < 20; i++) {
                explosionParticles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 6, // Vitesse horizontale
                    vy: (Math.random() - 0.5) * 6, // Vitesse verticale
                    size: Math.random() * 5 + 2,
                    life: 20 // Durée de vie en frames
                });
            }
        }

        // Mettre à jour les particules
        function updateExplosion() {
            explosionParticles = explosionParticles.filter(p => p.life > 0);
            explosionParticles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                p.size *= 0.95; // Réduction progressive
            });
        }

        // Dessiner la scène
        function drawScene() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Courbe
            ctx.beginPath();
            ctx.strokeStyle = "#ffd700";
            ctx.lineWidth = 2;
            ctx.moveTo(0, canvas.height);
            curvePoints.forEach((point, i) => {
                ctx.lineTo(i * 1.5, canvas.height - Math.min(point * 12, canvas.height));
            });
            ctx.stroke();

            // Sol
            ctx.fillStyle = "#8BC34A";
            ctx.fillRect(0, 80, canvas.width, 40);

            // Cheval
            if (!explosion) {
                ctx.fillStyle = "#795548";
                ctx.fillRect(horseX % canvas.width, 60, 25, 15);
                ctx.fillRect((horseX - 8) % canvas.width, 65, 6, 10);
                ctx.fillStyle = "#000";
                ctx.fillRect((horseX + 25) % canvas.width, 65, 6, 10);
            }

            // Fusée détaillée (si crash)
            if (isCrashed && rocketY < 60) {
                rocketY += 5; // Chute
            }
            if (isCrashed && !explosion) {
                const rocketX = (horseX % canvas.width) + 5;
                ctx.fillStyle = "#F44336";
                ctx.fillRect(rocketX, rocketY - 20, 15, 30); // Corps
                ctx.beginPath();
                ctx.moveTo(rocketX + 7.5, rocketY - 20);
                ctx.lineTo(rocketX + 15, rocketY - 30);
                ctx.lineTo(rocketX, rocketY - 30);
                ctx.fill(); // Pointe
                ctx.fillStyle = "#B0BEC5";
                ctx.fillRect(rocketX - 5, rocketY - 5, 5, 10); // Aileron gauche
                ctx.fillRect(rocketX + 15, rocketY - 5, 5, 10); // Aileron droit
            }

            // Explosion
            if (explosion) {
                updateExplosion();
                explosionParticles.forEach(p => {
                    ctx.fillStyle = `rgba(255, ${Math.random() * 100 + 100}, 0, ${p.life / 20})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
        }

        // Démarrer le jeu
        function startGame() {
            if (isRunning) return;

            bet = parseFloat(betInput.value);
            if (isNaN(bet) || bet <= 0 || bet > wallet) {
                alert("Mise invalide ou portefeuille insuffisant !");
                return;
            }

            wallet -= bet;
            walletDisplay.textContent = `Portefeuille : ${wallet.toFixed(2)}€`;
            multiplier = 1.0;
            isCrashed = false;
            isRunning = true;
            horseX = 0;
            rocketY = -30;
            explosion = false;
            explosionParticles = [];
            curvePoints = [multiplier];
            crashPoint = generateCrashPoint();
            multiplierDisplay.textContent = "1.00x";
            statusDisplay.textContent = "Le cheval galope...";
            probabilityDisplay.textContent = "Probabilité de crash : 0%";
            startButton.disabled = true;
            cashoutButton.disabled = false;
            betInput.disabled = true;

            interval = setInterval(() => {
                if (multiplier >= crashPoint) {
                    crash();
                } else {
                    multiplier += 0.05;
                    horseX += 2;
                    curvePoints.push(multiplier);
                    if (curvePoints.length > 200) curvePoints.shift();
                    multiplierDisplay.textContent = `${multiplier.toFixed(2)}x`;
                    probabilityDisplay.textContent = `Probabilité de crash : ${calculateCrashProbability().toFixed(1)}%`;
                    drawScene();
                }
            }, 50);
            drawScene();
        }

        // Gérer le crash
        function crash() {
            isCrashed = true;
            isRunning = false;
            clearInterval(interval);
            multiplierDisplay.textContent = `CRASH à ${crashPoint.toFixed(2)}x`;
            statusDisplay.textContent = crashPoint === 1.0 ? "Fusée explosive ! Oups !" : "Fusée crashée ! Réessaie ?";
            cashoutButton.disabled = true;
            startButton.disabled = false;
            betInput.disabled = false;

            // Animation fusée puis explosion
            let fallInterval = setInterval(() => {
                drawScene();
                if (rocketY >= 60) {
                    clearInterval(fallInterval);
                    createExplosion(horseX % canvas.width + 12.5, 65); // Explosion au centre du cheval
                    setTimeout(() => {
                        explosion = false;
                        ctx.fillStyle = "#F44336";
                        ctx.fillRect(horseX % canvas.width, 60, 25, 15); // Cheval écrasé
                        drawScene();
                    }, 1000); // Explosion dure 1s
                }
            }, 50);

            logResult(`Perdu - Mise: ${bet}€, Crash: ${crashPoint.toFixed(2)}x`);
            checkGameOver();
        }

        // Encaisser
        function cashOut() {
            if (!isRunning || isCrashed) return;

            clearInterval(interval);
            isRunning = false;
            winnings = bet * multiplier;
            wallet += winnings;
            walletDisplay.textContent = `Portefeuille : ${wallet.toFixed(2)}€`;
            statusDisplay.textContent = `Génial ! ${winnings.toFixed(2)}€ gagnés !`;

            if (multiplier < 1.5) {
                earlyCashouts++;
                if (earlyCashouts > 3) {
                    penaltyGames = 3;
                    earlyCashouts = 0;
                }
            }

            cashoutButton.disabled = true;
            startButton.disabled = false;
            betInput.disabled = false;
            ctx.fillStyle = "#FFD700";
            ctx.fillRect(horseX % canvas.width, 60, 25, 15);
            logResult(`Gagné - Mise: ${bet}€, Multi: ${multiplier.toFixed(2)}x, Gains: ${winnings.toFixed(2)}€`);
        }

        // Vérifier fin de jeu
        function checkGameOver() {
            if (wallet <= 0) {
                statusDisplay.textContent = "Portefeuille vide ! Merci d’avoir joué !";
                startButton.disabled = true;
                betInput.disabled = true;
            }
        }

        // Historique
        function logResult(message) {
            const entry = document.createElement("p");
            entry.textContent = message;
            historyDisplay.insertBefore(entry, historyDisplay.firstChild);
            if (historyDisplay.children.length > 5) {
                historyDisplay.removeChild(historyDisplay.lastChild);
            }
        }

        // Événements
        startButton.addEventListener("click", startGame);
        cashoutButton.addEventListener("click", cashOut);

        // Scène initiale
        drawScene();
    </script>
</body>
</html>