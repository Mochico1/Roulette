<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crash Sauveteur - Design Avancé</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        #game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            width: 700px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        #multiplier {
            font-size: 60px;
            font-weight: bold;
            color: #ffd700;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        #status {
            font-size: 20px;
            margin: 15px 0;
            color: #e0e0e0;
        }
        #wallet {
            font-size: 18px;
            color: #00e676;
            margin-bottom: 20px;
        }
        #bet-container {
            margin: 20px 0;
        }
        input[type="number"] {
            padding: 8px;
            font-size: 16px;
            width: 100px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        button {
            padding: 12px 25px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 25px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        button#start {
            background: linear-gradient(45deg, #4caf50, #81c784);
        }
        button#cashout {
            background: linear-gradient(45deg, #ff9800, #ffb300);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #game-canvas {
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
            margin: 20px 0;
        }
        #history {
            margin-top: 20px;
            font-size: 14px;
            color: #b0bec5;
            max-height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Crash Sauveteur</h1>
        <div id="wallet">Portefeuille : 100.00€</div>
        <div id="multiplier">1.00x</div>
        <canvas id="game-canvas" width="600" height="250"></canvas>
        <div id="status">Placez votre mise pour commencer.</div>
        <div id="bet-container">
            <label>Mise (€) : </label>
            <input type="number" id="bet" min="1" max="100" value="10">
        </div>
        <button id="start">Démarrer</button>
        <button id="cashout" disabled>Encaisser</button>
        <div id="history"></div>
    </div>

    <script>
        let multiplier = 1.0;
        let isCrashed = false;
        let isRunning = false;
        let crashPoint = 0;
        let interval;
        let bet = 0;
        let winnings = 0;
        let wallet = 100.0; // Portefeuille initial
        let horseX = 0;
        let curvePoints = [];

        const canvas = document.getElementById("game-canvas");
        const ctx = canvas.getContext("2d");
        const multiplierDisplay = document.getElementById("multiplier");
        const statusDisplay = document.getElementById("status");
        const walletDisplay = document.getElementById("wallet");
        const betInput = document.getElementById("bet");
        const startButton = document.getElementById("start");
        const cashoutButton = document.getElementById("cashout");
        const historyDisplay = document.getElementById("history");

        // Générer un crash mesuré (entre 1.1x et 10x)
        function generateCrashPoint() {
            return Math.random() * (10 - 1.1) + 1.1; // Plage contrôlée
        }

        // Dessiner la scène
        function drawScene() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Courbe du multiplicateur
            ctx.beginPath();
            ctx.strokeStyle = "#ffd700";
            ctx.lineWidth = 2;
            ctx.moveTo(0, canvas.height);
            curvePoints.forEach((point, i) => {
                ctx.lineTo(i * 2, canvas.height - point * 20);
            });
            ctx.stroke();

            // Sol
            ctx.fillStyle = "#8BC34A";
            ctx.fillRect(0, 200, canvas.width, 50);

            // Princesse
            ctx.fillStyle = "#F06292";
            ctx.fillRect(550, 150, 20, 50);
            ctx.beginPath();
            ctx.arc(560, 140, 10, 0, Math.PI * 2);
            ctx.fill();

            // Cheval (sprite simplifié)
            ctx.fillStyle = "#795548";
            ctx.fillRect(horseX, 170, 40, 30);
            ctx.fillRect(horseX - 10, 180, 10, 20);
            ctx.fillStyle = "#000";
            ctx.fillRect(horseX + 40, 180, 10, 20);
        }

        // Démarrer le jeu
        function startGame() {
            if (isRunning) return;

            bet = parseFloat(betInput.value);
            if (isNaN(bet) || bet <= 0 || bet > wallet) {
                alert("Mise invalide ou portefeuille insuffisant !");
                return;
            }

            wallet -= bet;
            walletDisplay.textContent = `Portefeuille : ${wallet.toFixed(2)}€`;
            multiplier = 1.0;
            isCrashed = false;
            isRunning = true;
            horseX = 0;
            curvePoints = [multiplier];
            crashPoint = generateCrashPoint();
            multiplierDisplay.textContent = "1.00x";
            statusDisplay.textContent = "Le cheval galope vers la princesse...";
            startButton.disabled = true;
            cashoutButton.disabled = false;
            betInput.disabled = true;

            interval = setInterval(() => {
                if (multiplier >= crashPoint) {
                    crash();
                } else {
                    multiplier += 0.05;
                    horseX += 2.5;
                    if (horseX > canvas.width - 50) horseX = canvas.width - 50;
                    curvePoints.push(multiplier);
                    if (curvePoints.length > 300) curvePoints.shift();
                    multiplierDisplay.textContent = `${multiplier.toFixed(2)}x`;
                    drawScene();
                }
            }, 50);
            drawScene();
        }

        // Gérer le crash
        function crash() {
            isCrashed = true;
            isRunning = false;
            clearInterval(interval);
            multiplierDisplay.textContent = `CRASH à ${crashPoint.toFixed(2)}x`;
            statusDisplay.textContent = `Le cheval s'est écrasé !`;
            cashoutButton.disabled = true;
            startButton.disabled = false;
            betInput.disabled = false;
            ctx.fillStyle = "#F44336";
            ctx.fillRect(horseX, 170, 40, 30);
            logResult(`Perdu - Mise: ${bet}€, Crash: ${crashPoint.toFixed(2)}x`);
            checkGameOver();
        }

        // Encaisser
        function cashOut() {
            if (!isRunning || isCrashed) return;

            clearInterval(interval);
            isRunning = false;
            winnings = bet * multiplier;
            wallet += winnings;
            walletDisplay.textContent = `Portefeuille : ${wallet.toFixed(2)}€`;
            statusDisplay.textContent = `Princesse sauvée ! ${winnings.toFixed(2)}€ à ${multiplier.toFixed(2)}x`;
            cashoutButton.disabled = true;
            startButton.disabled = false;
            betInput.disabled = false;
            ctx.fillStyle = "#FFD700";
            ctx.fillRect(550, 150, 20, 50);
            logResult(`Gagné - Mise: ${bet}€, Multi: ${multiplier.toFixed(2)}x, Gains: ${winnings.toFixed(2)}€`);
        }

        // Vérifier fin de jeu
        function checkGameOver() {
            if (wallet <= 0) {
                statusDisplay.textContent = "Portefeuille vide ! Fin du jeu.";
                startButton.disabled = true;
                betInput.disabled = true;
            }
        }

        // Historique
        function logResult(message) {
            const entry = document.createElement("p");
            entry.textContent = message;
            historyDisplay.insertBefore(entry, historyDisplay.firstChild);
            if (historyDisplay.children.length > 5) {
                historyDisplay.removeChild(historyDisplay.lastChild);
            }
        }

        // Événements
        startButton.addEventListener("click", startGame);
        cashoutButton.addEventListener("click", cashOut);

        // Scène initiale
        drawScene();
    </script>
</body>
</html>