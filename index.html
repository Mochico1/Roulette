<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crash Runner - Casino</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }
        #game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            width: 100%;
            max-width: 320px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            box-sizing: border-box;
        }
        #multiplier {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }
        #status, #probability {
            font-size: 12px;
            margin: 5px 0;
            color: #e0e0e0;
        }
        #wallet {
            font-size: 12px;
            color: #00e676;
            margin: 5px 0;
        }
        #bet-container {
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        input[type="number"] {
            padding: 5px;
            font-size: 12px;
            width: 70px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        button {
            padding: 6px 12px;
            font-size: 12px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 15px;
            transition: transform 0.2s;
        }
        button:hover:not(:disabled) {
            transform: scale(1.05);
        }
        button#start {
            background: linear-gradient(45deg, #4caf50, #81c784);
        }
        button#cashout {
            background: linear-gradient(45deg, #ff9800, #ffb300);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #game-canvas {
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.2);
            width: 100%;
            height: 120px;
            margin: 10px 0;
        }
        #history {
            font-size: 10px;
            color: #b0bec5;
            max-height: 60px;
            overflow-y: auto;
            margin-top: 10px;
        }
        h1 {
            font-size: 18px;
            margin: 0 0 10px 0;
        }
        @media (max-width: 360px) {
            #game-container {
                padding: 10px;
            }
            #multiplier {
                font-size: 28px;
            }
            button {
                padding: 5px 10px;
                font-size: 10px;
            }
            input[type="number"] {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Crash Runner</h1>
        <div id="wallet">Portefeuille : 100.00€</div>
        <div id="multiplier">1.00x</div>
        <canvas id="game-canvas" width="280" height="120"></canvas>
        <div id="status">Placez votre mise pour commencer.</div>
        <div id="probability">Probabilité de crash : 0%</div>
        <div id="bet-container">
            <label>Mise (€) : </label>
            <input type="number" id="bet" min="1" max="100" value="10">
        </div>
        <button id="start">Démarrer</button>
        <button id="cashout" disabled>Encaisser</button>
        <div id="history"></div>
    </div>

    <script>
        let multiplier = 1.0;
        let isCrashed = false;
        let isRunning = false;
        let crashPoint = 0;
        let interval;
        let bet = 0;
        let winnings = 0;
        let wallet = 100.0;
        let horseX = 0;
        let curvePoints = [];
        let gameCount = 0;

        const canvas = document.getElementById("game-canvas");
        const ctx = canvas.getContext("2d");
        const multiplierDisplay = document.getElementById("multiplier");
        const statusDisplay = document.getElementById("status");
        const probabilityDisplay = document.getElementById("probability");
        const walletDisplay = document.getElementById("wallet");
        const betInput = document.getElementById("bet");
        const startButton = document.getElementById("start");
        const cashoutButton = document.getElementById("cashout");
        const historyDisplay = document.getElementById("history");

        // Générer un crash truqué avec gros gains initiaux
        function generateCrashPoint() {
            gameCount++;
            const random = Math.random();

            if (gameCount === 1) {
                return 20; // Premier coup : x20 garanti
            } else if (gameCount === 2) {
                return 15; // Deuxième coup : x15 garanti
            } else if (random < 0.01 && gameCount > 10) { // 1% de chance d’un gros gain après 10 parties
                return 100 + random * 20; // x100 à x120 (rare)
            } else if (random < 0.6) { // 60% de crashs bas
                return 1.1 + random * 1.9; // 1.1x à 3x
            } else if (random < 0.9) { // 30% de crashs moyens
                return 3 + random * 2; // 3x à 5x
            } else { // 9% de crashs modérés
                return 5 + random * 5; // 5x à 10x
            }
        }

        // Probabilité affichée (illusion)
        function calculateCrashProbability() {
            const maxCrash = 120;
            return Math.min(100, ((multiplier - 1) / (maxCrash - 1)) * 70); // Sous-estimée pour l’espoir
        }

        // Dessiner la scène
        function drawScene() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Courbe
            ctx.beginPath();
            ctx.strokeStyle = "#ffd700";
            ctx.lineWidth = 2;
            ctx.moveTo(0, canvas.height);
            curvePoints.forEach((point, i) => {
                ctx.lineTo(i * 1.5, canvas.height - Math.min(point * 12, canvas.height));
            });
            ctx.stroke();

            // Sol
            ctx.fillStyle = "#8BC34A";
            ctx.fillRect(0, 80, canvas.width, 40);

            // Cheval
            ctx.fillStyle = "#795548";
            ctx.fillRect(horseX % canvas.width, 60, 25, 15);
            ctx.fillRect((horseX - 8) % canvas.width, 65, 6, 10);
            ctx.fillStyle = "#000";
            ctx.fillRect((horseX + 25) % canvas.width, 65, 6, 10);
        }

        // Démarrer le jeu
        function startGame() {
            if (isRunning) return;

            bet = parseFloat(betInput.value);
            if (isNaN(bet) || bet <= 0 || bet > wallet) {
                alert("Mise invalide ou portefeuille insuffisant !");
                return;
            }

            wallet -= bet;
            walletDisplay.textContent = `Portefeuille : ${wallet.toFixed(2)}€`;
            multiplier = 1.0;
            isCrashed = false;
            isRunning = true;
            horseX = 0;
            curvePoints = [multiplier];
            crashPoint = generateCrashPoint();
            multiplierDisplay.textContent = "1.00x";
            statusDisplay.textContent = "Le cheval galope...";
            probabilityDisplay.textContent = "Probabilité de crash : 0%";
            startButton.disabled = true;
            cashoutButton.disabled = false;
            betInput.disabled = true;

            interval = setInterval(() => {
                if (multiplier >= crashPoint) {
                    crash();
                } else {
                    multiplier += 0.05;
                    horseX += 2;
                    curvePoints.push(multiplier);
                    if (curvePoints.length > 200) curvePoints.shift();
                    multiplierDisplay.textContent = `${multiplier.toFixed(2)}x`;
                    probabilityDisplay.textContent = `Probabilité de crash : ${calculateCrashProbability().toFixed(1)}%`;
                    drawScene();
                }
            }, 50);
            drawScene();
        }

        // Gérer le crash
        function crash() {
            isCrashed = true;
            isRunning = false;
            clearInterval(interval);
            multiplierDisplay.textContent = `CRASH à ${crashPoint.toFixed(2)}x`;
            statusDisplay.textContent = "Pas de chance ! Tente encore ?";
            cashoutButton.disabled = true;
            startButton.disabled = false;
            betInput.disabled = false;
            ctx.fillStyle = "#F44336";
            ctx.fillRect(horseX % canvas.width, 60, 25, 15);
            logResult(`Perdu - Mise: ${bet}€, Crash: ${crashPoint.toFixed(2)}x`);
            checkGameOver();
        }

        // Encaisser
        function cashOut() {
            if (!isRunning || isCrashed) return;

            clearInterval(interval);
            isRunning = false;
            winnings = bet * multiplier;
            wallet += winnings;
            walletDisplay.textContent = `Portefeuille : ${wallet.toFixed(2)}€`;
            statusDisplay.textContent = `Génial ! ${winnings.toFixed(2)}€ gagnés !`;
            cashoutButton.disabled = true;
            startButton.disabled = false;
            betInput.disabled = false;
            ctx.fillStyle = "#FFD700";
            ctx.fillRect(horseX % canvas.width, 60, 25, 15);
            logResult(`Gagné - Mise: ${bet}€, Multi: ${multiplier.toFixed(2)}x, Gains: ${winnings.toFixed(2)}€`);
        }

        // Vérifier fin de jeu
        function checkGameOver() {
            if (wallet <= 0) {
                statusDisplay.textContent = "Portefeuille vide ! Merci d’avoir joué !";
                startButton.disabled = true;
                betInput.disabled = true;
            }
        }

        // Historique
        function logResult(message) {
            const entry = document.createElement("p");
            entry.textContent = message;
            historyDisplay.insertBefore(entry, historyDisplay.firstChild);
            if (historyDisplay.children.length > 5) {
                historyDisplay.removeChild(historyDisplay.lastChild);
            }
        }

        // Événements
        startButton.addEventListener("click", startGame);
        cashoutButton.addEventListener("click", cashOut);

        // Scène initiale
        drawScene();
    </script>
</body>
</html>