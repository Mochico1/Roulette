<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Roulette avec Tapis, Timer et Spin Auto</title>

  <!-- React / ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  
  <!-- GSAP pour l'animation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* =================== RESET / BASE =================== */
    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
    }
    body {
      background: radial-gradient(circle, #222, #000);
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 0;
      margin: 0;
    }
    
    /* =================== CONTAINER PRINCIPAL =================== */
    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 10px;
    }
    h1 {
      margin-bottom: 10px;
    }
    
    .section-title {
      margin: 15px 0 5px 0;
      font-size: 18px;
    }

    /* =================== TIMER =================== */
    .timer {
      font-size: 22px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    /* =================== TAPIS DE PARIS =================== */
    .tapis-container {
      background: #006400; /* vert foncé casino */
      border: 3px solid #0a5f0a;
      border-radius: 8px;
      padding: 10px;
      margin: 0 auto 20px;
      max-width: 600px;
    }
    .tapis-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 5px;
      margin-top: 10px;
    }
    /* Case d'un numéro sur le tapis */
    .tapis-cell {
      width: 40px; 
      height: 40px;
      background: #013201;
      border-radius: 4px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      color: white;
      border: 2px solid #115511; 
    }
    .tapis-cell.checked {
      background: #02a702; 
      border-color: #0f3;
    }
    /* 0 s'affiche sur la première colonne, on fera un style à part */
    .zero-cell {
      grid-column: span 2; /* plus large si tu veux */
      background: #004400;
    }
    
    /* Options de pari (Rouge, Noir, Pair, Impair) */
    .options-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 10px;
    }
    .option-item {
      display: flex;
      align-items: center;
      background: #013201;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      border: 2px solid #115511;
    }
    .option-item input {
      margin-right: 5px;
      cursor: pointer;
    }
    .option-item.active {
      background: #02a702; 
      border-color: #0f3;
    }

    /* =================== ROULETTE =================== */
    .roulette-section {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .roulette-wrapper {
      position: relative;
      width: 300px;
      height: 300px;
      margin-bottom: 15px;
    }
    .wheel {
      position: relative;
      width: 100%;
      height: 100%;
      border: 5px solid gold;
      border-radius: 50%;
      overflow: hidden;
      background: #333;
    }
    /* Pointeur fixe en haut */
    .pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 20px solid yellow;
      z-index: 10;
    }
    /* Les 37 secteurs */
    .sector {
      position: absolute;
      width: 50%; 
      height: 50%;
      left: 50%; 
      top: 50%;
      transform-origin: 0 100%;
      border-top-left-radius: 100%;
      border-top-right-radius: 100%;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding-left: 10px;
      font-weight: bold;
      font-size: 14px;
    }
    .sector-number {
      transform: rotate(-90deg);
    }

    /* =================== RESULTAT =================== */
    .result {
      font-size: 20px;
      margin-top: 10px;
      min-height: 28px; /* éviter le saut */
    }
    .message {
      margin-top: 5px;
      font-size: 18px;
      color: #ffcc00; /* jaune or */
      min-height: 24px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    /***********************************************
     * Tableau de 37 cases (roulette européenne)
     ***********************************************/
    const sectorsData = [
      { number: 0, color: 'green' },
      { number: 1, color: 'red' },
      { number: 2, color: 'black' },
      { number: 3, color: 'red' },
      { number: 4, color: 'black' },
      { number: 5, color: 'red' },
      { number: 6, color: 'black' },
      { number: 7, color: 'red' },
      { number: 8, color: 'black' },
      { number: 9, color: 'red' },
      { number: 10, color: 'black' },
      { number: 11, color: 'black' },
      { number: 12, color: 'red' },
      { number: 13, color: 'black' },
      { number: 14, color: 'red' },
      { number: 15, color: 'black' },
      { number: 16, color: 'red' },
      { number: 17, color: 'black' },
      { number: 18, color: 'red' },
      { number: 19, color: 'red' },
      { number: 20, color: 'black' },
      { number: 21, color: 'red' },
      { number: 22, color: 'black' },
      { number: 23, color: 'red' },
      { number: 24, color: 'black' },
      { number: 25, color: 'red' },
      { number: 26, color: 'black' },
      { number: 27, color: 'red' },
      { number: 28, color: 'black' },
      { number: 29, color: 'black' },
      { number: 30, color: 'red' },
      { number: 31, color: 'black' },
      { number: 32, color: 'red' },
      { number: 33, color: 'black' },
      { number: 34, color: 'red' },
      { number: 35, color: 'black' },
      { number: 36, color: 'red' },
    ];
    const sectorAngle = 360 / sectorsData.length; // ~9.73°

    /***********************************************
     * Composant principal App
     ***********************************************/
    function App() {
      return (
        <div className="container">
          <h1>Roulette Européenne</h1>
          <Game />
        </div>
      );
    }

    function Game() {
      /* État du jeu */
      const [timeLeft, setTimeLeft] = React.useState(30); // 30s
      const [spinDone, setSpinDone] = React.useState(false); // pour éviter 2 spins
      const [bets, setBets] = React.useState({
        numbers: new Set(),
        red: false,
        black: false,
        even: false,
        odd: false,
      });

      /* État roulette */
      const [isSpinning, setIsSpinning] = React.useState(false);
      const [totalRotation, setTotalRotation] = React.useState(0);
      const wheelRef = React.useRef(null);

      /* Résultat final */
      const [result, setResult] = React.useState(null);   // { number, color }
      const [message, setMessage] = React.useState('');   // "Bravo"/"Désolé"/"Dommage"

      /* Timer => spin auto après 30s */
      React.useEffect(() => {
        if (timeLeft <= 0 && !spinDone) {
          doSpin();
          setSpinDone(true);
          return;
        }
        if (timeLeft > 0 && !spinDone) {
          const timerId = setInterval(() => {
            setTimeLeft(prev => prev - 1);
          }, 1000);
          return () => clearInterval(timerId);
        }
      }, [timeLeft, spinDone]);

      /* ====== Fonction de spin automatique ====== */
      function doSpin() {
        if (isSpinning) return;
        setIsSpinning(true);
        setResult(null);
        setMessage('');

        // Choisir un secteur aléatoire
        const randomSector = Math.floor(Math.random() * sectorsData.length);

        // 5 tours complets = 5 * 360 = 1800
        const fullTurns = 360 * 5;
        // Angle final
        const finalRotation = totalRotation + fullTurns - (randomSector * sectorAngle);

        gsap.to(wheelRef.current, {
          rotation: finalRotation,
          duration: 4.5,  // durée de l'animation
          ease: "power2.out",
          transformOrigin: "50% 50%",
          onComplete: () => {
            setTotalRotation(finalRotation);
            setIsSpinning(false);

            const landed = sectorsData[randomSector];
            setResult(landed);
            
            // Vérifier gain/perte + affichage message
            showOutcome(landed);
          }
        });
      }

      /* ====== Vérifier gain/perte => setMessage() ====== */
      function showOutcome(landed) {
        const { numbers, red, black, even, odd } = bets;

        // Si aucune mise
        const noBet =
          numbers.size === 0 && 
          red === false &&
          black === false &&
          even === false &&
          odd === false;

        if (noBet) {
          setMessage("Dommage, vous auriez pu gagner avec nous aujourd’hui !");
          return;
        }

        let isWinner = false;
        // num
        if (numbers.has(landed.number)) {
          isWinner = true;
        }
        // couleur
        if (red && landed.color === 'red') {
          isWinner = true;
        }
        if (black && landed.color === 'black') {
          isWinner = true;
        }
        // pair/impair (0 = ni pair ni impair)
        if (even && landed.number !== 0 && landed.number % 2 === 0) {
          isWinner = true;
        }
        if (odd && landed.number % 2 === 1) {
          isWinner = true;
        }

        if (isWinner) {
          setMessage("Bravo, vous avez gagné !");
        } else {
          setMessage("Désolé, vous avez perdu !");
        }
      }

      /* ====== Sélection des mises ====== */
      function toggleNumber(n) {
        if (isSpinning || spinDone) return; // plus de changement si spin enclenché
        const newNumbers = new Set(bets.numbers);
        if (newNumbers.has(n)) newNumbers.delete(n);
        else newNumbers.add(n);
        setBets({ ...bets, numbers: newNumbers });
      }
      function toggleOption(opt) {
        if (isSpinning || spinDone) return;
        setBets({ ...bets, [opt]: !bets[opt] });
      }

      return (
        <>
          {/* Timer affiché */}
          <div className="timer">
            {timeLeft > 0 
              ? `Misez vite : ${timeLeft}s…`
              : spinDone 
                ? "La roulette est terminée." 
                : "La roulette va tourner !"
            }
          </div>
          
          {/* TAPIS pour parier */}
          <Tapis bets={bets} toggleNumber={toggleNumber} toggleOption={toggleOption} />

          {/* ROULETTE */}
          <div className="roulette-section">
            <div className="roulette-wrapper">
              <div className="pointer"></div>
              <div ref={wheelRef} className="wheel">
                {sectorsData.map((sec, i) => {
                  const angle = i * sectorAngle;
                  return (
                    <div
                      key={i}
                      className="sector"
                      style={{
                        transform: `rotate(${angle}deg)`,
                        backgroundColor: sec.color,
                        color: sec.color === 'black' ? '#fff' : '#000'
                      }}
                    >
                      <div className="sector-number">{sec.number}</div>
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Affichage du résultat */}
            <div className="result">
              {result && (
                <span>
                  Résultat : <strong style={{
                    color: result.color === 'black' ? '#ccc' : result.color
                  }}>
                    {result.number}
                  </strong>
                </span>
              )}
            </div>
            <div className="message">{message}</div>
          </div>
        </>
      );
    }

    /* ==================== Tapis : grille 0..36 + options rouge/noir/pair/impair ==================== */
    function Tapis({ bets, toggleNumber, toggleOption }) {
      // On affiche 12 colonnes, 3 lignes => numéros 1..36
      // Sur la 1ère ligne, on peut mettre 1..12, 2e = 13..24, 3e = 25..36, plus la case 0 à part
      // Pour simplifier, on fait juste un "grid" 12 colonnes, 3 rangées, plus 1 case pour 0
      // On colorie en style "rouge" / "noir" / "vert" ? Ici on se contente d'un hover ou d'un checked

      // Options
      const { red, black, even, odd } = bets;

      // On construit la liste [1..36]
      const numbers1to36 = sectorsData.filter(s => s.number >= 1 && s.number <= 36);

      return (
        <div className="tapis-container">
          <div className="section-title">Choisissez vos mises</div>

          {/* Options (Rouge, Noir, Pair, Impair) */}
          <div className="options-row">
            <label 
              className={`option-item ${red ? 'active' : ''}`}
            >
              <input 
                type="checkbox" 
                checked={red} 
                onChange={() => toggleOption('red')}
              />
              Rouge
            </label>
            <label
              className={`option-item ${black ? 'active' : ''}`}
            >
              <input
                type="checkbox"
                checked={black}
                onChange={() => toggleOption('black')}
              />
              Noir
            </label>
            <label
              className={`option-item ${even ? 'active' : ''}`}
            >
              <input
                type="checkbox"
                checked={even}
                onChange={() => toggleOption('even')}
              />
              Pair
            </label>
            <label
              className={`option-item ${odd ? 'active' : ''}`}
            >
              <input
                type="checkbox"
                checked={odd}
                onChange={() => toggleOption('odd')}
              />
              Impair
            </label>
          </div>

          {/* Grille 0..36 */}
          <div className="tapis-grid">
            {/* Case 0 en haut à gauche */}
            <div 
              className={`tapis-cell zero-cell ${bets.numbers.has(0) ? 'checked' : ''}`} 
              style={{ gridColumn: '1 / 2' }}
              onClick={() => toggleNumber(0)}
            >
              0
            </div>

            {numbers1to36.map((sec) => (
              <div
                key={sec.number}
                className={`tapis-cell ${bets.numbers.has(sec.number) ? 'checked' : ''}`}
                onClick={() => toggleNumber(sec.number)}
              >
                {sec.number}
              </div>
            ))}
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>